<%= breadcrumb( { title: 'Appointment search' } ) %>

<h1>Appointment search</h1>

<%= form_for @search, method: 'GET', url: { action: :search }, html: { class: 'appointment-search form-inline' } do |f| %>
  <div class="form-group">
    <%= f.label :q, 'Search term' %>
    <%= f.text_field :q, use_label: false, class: 't-q appointment-search__term form-control', placeholder: 'Reference, name or guider' %>
  </div>
  <div class="form-group">
    <%= f.label :date_range, 'Date range' %>
    <%=
      f.text_field(
        :date_range,
        class: 't-date-range appointment-search__date-range form-control',
        use_label: false,
        placeholder: 'Appointment date range',
        data: {
          module: 'date-range-picker',
          config: {
            autoUpdateInput: false,
            autoApply: true,
            locale: {
              cancelLabel: 'Clear',
              format: 'DD/MM/YYYY'
            }
          }
        }
      )
    %>
  </div>
  <div class="form-group">
    <%= f.submit 'Search', class: 't-search btn btn-primary' %>
  </div>
<% end %>

<table id="results" class="appointment-search-results table table-striped table-bordered table-hover">
  <caption><span class="sr-only">Appointment search results</span></caption>
  <thead>
    <tr>
      <th>Reference</th>
      <th>Created</th>
      <th>First Name</th>
      <th>Last Name</th>
      <th>Guider</th>
      <th>Appointment Date/Time</th>
      <th>Status</th>
      <th width="1%">Actions</th>
    </tr>
  </thead>
  <tbody class="list" data-module="search-highlight">
    <% @results.each do |result| %>
      <% result = AppointmentSearchResultPresenter.new(result) %>
      <tr class="t-result">
        <td class="t-id"><span class="id js-allow-highlighting">#<%= result.id %></span></td>
        <td><%= result.created_at %></td>
        <td class="t-first-name js-allow-highlighting"><%= result.first_name %></td>
        <td class="js-allow-highlighting"><%= result.last_name %></td>
        <td class="js-allow-highlighting"><%= result.guider_name %></td>
        <td><%= result.date %></td>
        <td><%= result.status %></td>
        <td nowrap="true">
          <%= link_to edit_appointment_path(result), title: 'Edit appointment', class: 'btn btn-info' do %>
            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
            <span class="sr-only">Edit appointment</span>
          <% end %>
          <% if result.can_be_rescheduled_by?(current_user) %>
            <%= link_to appointment_reschedule_path(result), title: 'Reschedule appointment', class: 'btn btn-info' do %>
              <span class="glyphicon glyphicon-calendar" aria-hidden="true"></span>
              <span class="sr-only">Reschedule appointment</span>
            <% end %>
          <% end %>
          <%= link_to new_appointment_path(copy_from: result), title: 'Rebook appointment', class: 'btn btn-info t-rebook' do %>
            <span class="glyphicon glyphicon-repeat" aria-hidden="true"></span>
            <span class="sr-only">Rebook appointment</span>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<nav aria-label="Pagination">
  <%= paginate @results %>
</nav>
